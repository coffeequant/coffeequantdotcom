<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Barrier Shift Estimator — CoffeeQuant Tools</title>
<link rel="stylesheet" href="../css/cq.css" />

<style>
  .tool-wrap {
    max-width: 800px;
    margin: 2rem auto;
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius);
    box-shadow: var(--panel-shadow);
    padding: 1rem 1.25rem 2rem;
  }
  .tool-head {
    display:flex;
    flex-wrap:wrap;
    justify-content:space-between;
    align-items:flex-start;
    gap:1rem;
    margin-bottom:1rem;
  }
  .tool-head h1 {
    margin:0;
    font-size:1.2rem;
    line-height:1.3;
  }
  .tool-form {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:0.75rem 1rem;
    margin-bottom:1rem;
  }
  .tool-form label {
    font-size:.8rem;
    color:var(--muted);
    display:block;
    margin-bottom:.25rem;
  }
  .tool-form input {
    width:100%;
    font-size:.9rem;
    padding:.5rem .6rem;
    border-radius:8px;
    border:1px solid var(--panel-border);
    background:var(--card-bg);
    color:var(--fg);
  }
  .tool-actions {
    display:flex;
    flex-wrap:wrap;
    gap:.5rem;
    margin-bottom:1rem;
  }
  .outbox {
    font-size:.85rem;
    line-height:1.5;
    background:var(--card-bg);
    border:1px solid var(--panel-border);
    border-radius:var(--radius);
    padding:1rem;
    white-space:pre-line;
  }
  a.cq-logo-mini {
    text-decoration:none;
    color:var(--fg);
    font-size:.8rem;
    font-weight:600;
  }
  .muted { color:var(--muted); font-size:.8rem; line-height:1.4;}
</style>
</head>
<body>

<div class="tool-wrap">
  <div class="tool-head">
    <div>
      <h1>Barrier Shift Estimator</h1>
      <div class="cq-muted" style="font-size:.8rem;max-width:480px;">
        Traders hate pin risk near the barrier into expiry. This tool gives a
        “shifted barrier” you could quote so P&amp;L bleed sits inside your fee,
        given vol and liquidity.
      </div>
    </div>
    <div>
      <a class="cq-logo-mini" href="../../index.html">☕ CoffeeQuant Home →</a>
    </div>
  </div>

  <form class="tool-form" onsubmit="return false;">
    <div>
      <label>Spot</label>
      <input id="bs_spot" type="number" value="100">
    </div>
    <div>
      <label>Client barrier (Up&Out)</label>
      <input id="bs_barrier" type="number" value="120">
    </div>
    <div>
      <label>Annual vol %</label>
      <input id="bs_vol" type="number" step="0.1" value="20">
    </div>
    <div>
      <label>Time to expiry (days)</label>
      <input id="bs_days" type="number" value="30">
    </div>
    <div>
      <label>Desk fee % of notional</label>
      <input id="bs_fee" type="number" step="0.1" value="1">
    </div>
    <div>
      <label>ADV (k lots/day)</label>
      <input id="bs_adv" type="number" step="1" value="3">
    </div>
  </form>

  <div class="tool-actions">
    <button class="cq-btn" onclick="runBarrier()">Estimate Shift</button>
    <button class="cq-btn-ghost" onclick="clearBarrier()">Clear</button>
  </div>

  <div id="bs_out" class="outbox">
    -- result will appear here --
  </div>

  <div class="muted" style="margin-top:1rem;">
    This is not a formal pricing model.
    It's a sanity check to explain to sales why you're not quoting the naive barrier.
  </div>
</div>

<script>
// super simple heuristic model:
// We assume hedging pain ~ (vol * sqrt(time)) * illiquidity_penalty
// and we cap that to some fraction of fee.
// We then convert that "pain" into a % buffer above barrier.
//
// This is deliberately desk-style intuition, not a PDE.
function runBarrier(){
  const spot   = parseFloat(document.getElementById('bs_spot').value)||100;
  const B      = parseFloat(document.getElementById('bs_barrier').value)||120;
  const vol    = (parseFloat(document.getElementById('bs_vol').value)||20)/100; // to decimal
  const days   = parseFloat(document.getElementById('bs_days').value)||30;
  const feePct = (parseFloat(document.getElementById('bs_fee').value)||1)/100;  // e.g. 1% fee
  const adv    = parseFloat(document.getElementById('bs_adv').value)||3;        // "k lots/day"

  // time factor ~ sqrt(T)
  const tYears = days/252;
  const shockScale = vol*Math.sqrt(tYears); // ~ 1 stdev move over time left

  // liquidity penalty ~ 1 / ADV
  const liqPenalty = 1/Math.max(adv,0.1);

  // raw pain ~ how ugly the hedge near barrier could be as % notional
  const rawPain = shockScale * liqPenalty; // dimensionless "stress factor"

  // we allow up to ~40% of fee to cover this pain (tweakable desk knob)
  const budget = 0.4*feePct;

  // shift% is how much extra headroom we want above the stated barrier
  // clipped to something not insane
  let shiftPct = rawPain / (budget || 1e-6);
  if(shiftPct > 0.05) shiftPct = 0.05; // cap at +5%
  if(shiftPct < 0) shiftPct = 0;

  const shiftedBarrier = B * (1+shiftPct);

  // story text
  const msg =
`Client barrier: ${B.toFixed(2)}
Suggested internal barrier: ~${shiftedBarrier.toFixed(2)}  (+${(shiftPct*100).toFixed(2)}%)

Why?
• Vol into expiry ~ ${(vol*100).toFixed(1)}% annual, ${days}d left
  ⇒ ~${(shockScale*100).toFixed(2)}% 1-sigma move in the window you actually care about.
• ADV ~ ${adv}k lots/day ⇒ liquidity penalty ${liqPenalty.toFixed(2)}
• Hedge panic near barrier is effectively costing ~${(rawPain*100).toFixed(2)}% of notional.
• Your desk fee is ~${(feePct*100).toFixed(2)}% of notional.
  We’re saying: “I can leak ~40% of that fee to gamma/vega stress.”
  That implies I shouldn't quote you barrier=${B} flat;
  I should behave as if it's ${shiftedBarrier.toFixed(2)}.

How to talk to sales:
"At ${B} I'm short a cliff in illiquid size into expiry.
If I price off ${shiftedBarrier.toFixed(2)} I stay inside fee.
If you NEED ${B}, I need more spread."`;

  document.getElementById('bs_out').textContent = msg;
}

function clearBarrier(){
  document.getElementById('bs_out').textContent = "-- result will appear here --";
}
</script>

</body>
</html>

