<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dice Puzzle ‚Äî Max of k Minimums from n Dice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Load MathJax ONCE globally in index.html. No MathJax script tag here. -->

  <style>
    /* readable, theme-aware, lightweight */
    .cq-article { max-width: 920px; margin: 0 auto; padding: 1rem 1.25rem 2rem; line-height: 1.6; color: inherit; }
    h1 { font-size: 1.9rem; margin: .2rem 0 .6rem; letter-spacing: -.01em; }
    h2 { font-size: 1.25rem; margin: 1.25rem 0 .5rem; }
    .muted { opacity: .78; }
    .card { background: color-mix(in oklab, currentColor 8%, transparent); border: 1px solid color-mix(in oklab, currentColor 24%, transparent);
            border-radius: 12px; padding: 1rem; }
    .row { display: flex; gap: .75rem; flex-wrap: wrap; align-items: center; }
    .col { flex: 1 1 300px; }
    .btn { background: #2563eb; color: #fff; border: 0; border-radius: 8px; padding: .55rem .9rem; cursor: pointer; font-size: .95rem; }
    .btn:hover { background: #1e40af; }
    .btn-ghost { background: transparent; border: 1px solid color-mix(in oklab, currentColor 30%, transparent); color: inherit; }
    .slider { width: 100%; }
    .pill { display:inline-block; border:1px solid color-mix(in oklab,currentColor 30%,transparent); border-radius:999px; padding:.15rem .6rem; font-size:.8rem; opacity:.9; }
    .grid { display:grid; grid-template-columns: repeat(6, 34px); gap:.35rem; justify-content:start; align-items:center; }
    .cell { width:34px; height:34px; border:1px solid color-mix(in oklab,currentColor 25%,transparent); border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:600; }
    .min { background:#fde68a; }
    .best { outline:2px solid #22c55e; outline-offset:2px; }
    canvas { width:100%; height:220px; border:1px solid color-mix(in oklab,currentColor 24%,transparent); border-radius:12px; background: transparent; }
    details { border:1px dashed color-mix(in oklab,currentColor 30%,transparent); border-radius:10px; padding:.6rem .8rem; }
    summary { cursor: pointer; font-weight: 600; }
    .center { text-align:center; }
    .small { font-size: .92rem; }
    @media (prefers-color-scheme: dark) {
      .btn { background:#38bdf8; color:#0b1220; }
      .btn:hover { background:#0284c7; }
      .min { background:#78350f; }
    }
  </style>
</head>

<body>
  <article id="cq-article" class="cq-article">
    <header class="row" style="justify-content:space-between">
      <h1>Max of <em>k</em> minimums from <em>n</em> dice ‚Äî play it, then understand it</h1>
      <span class="pill">Dice ‚Ä¢ Probability ‚Ä¢ Combinatorics</span>
    </header>
    <p class="muted">Game: roll <strong>n</strong> dice, note the <em>minimum</em>. Do this <strong>k</strong> times. Keep the <strong>maximum</strong> of those minimums.</p>

    <!-- PLAY: controls + one-shot demo -->
    <section class="card">
      <div class="row">
        <div class="col">
          <label>Dice per set <strong>n</strong>: <span id="nOut">6</span></label>
          <input id="nDice" class="slider" type="range" min="1" max="12" value="6" oninput="updateLabels()" />
        </div>
        <div class="col">
          <label>Number of sets <strong>k</strong>: <span id="kOut">6</span></label>
          <input id="nSets" class="slider" type="range" min="1" max="12" value="6" oninput="updateLabels()" />
        </div>
        <div class="col">
          <button class="btn" onclick="stepOnce()">üé≤ One run</button>
        </div>
      </div>
      <div id="onceArea" style="margin-top:.75rem"></div>
      <p id="onceText" class="small muted"></p>
    </section>

    <!-- EXPERIMENT: many trials + histogram -->
    <section style="margin-top:1rem" class="card">
      <div class="row">
        <div class="col">
          <label>Trials (simulated games): <span id="tOut">1000</span></label>
          <input id="nTrials" class="slider" type="range" min="100" max="10000" step="100" value="1000" oninput="updateLabels()" />
        </div>
        <div class="col">
          <button class="btn" onclick="runTrials()">üöÄ Run simulation</button>
          <button class="btn btn-ghost" onclick="clearSim()">Clear</button>
        </div>
      </div>
      <div class="row" style="margin-top:.6rem">
        <div class="col"><canvas id="hist"></canvas></div>
        <div class="col">
          <div id="stats"></div>
          <p class="small muted">Tip: try larger <em>n</em> or <em>k</em> and see how the distribution shifts.</p>
        </div>
      </div>
    </section>

    <!-- INTUITION -->
    <h2>What should you expect?</h2>
    <p>
      The minimum of many dice tends to be small (there‚Äôs usually at least one low die).
      But when you repeat the set, sometimes one round is ‚Äúlucky‚Äù (all dice are reasonably high),
      so the <em>maximum</em> of the minimums nudges up. The tug-of-war usually lands near 2‚Äì3
      for \(n=6,k=6\), with an average about <strong>2.43</strong>.
    </p>

    <!-- MATH (collapsible, explained) -->
    <details id="mathBox" style="margin-top:1rem">
      <summary>Show the math (gentle, step-by-step)</summary>
      <div style="margin-top:.5rem">
        <h2>1) Minimum of one set (no scary symbols first)</h2>
        <p>
          In one set of \(n\) dice, the minimum is at least \(a\) if <em>every</em> die is at least \(a\).
          For fair dice that‚Äôs \(\big(\frac{7-a}{6}\big)^n\).
          The chance the minimum is exactly \(a\) is ‚Äúat least \(a\)‚Äù minus ‚Äúat least \(a+1\)‚Äù.
        </p>
        <p>
          In symbols (now that the idea is clear):
        </p>
        <p>
          \[
            \mathbb{P}(Y\ge a)=\Big(\tfrac{7-a}{6}\Big)^n,\quad
            \mathbb{P}(Y=a)=\Big(\tfrac{7-a}{6}\Big)^{\!n}-\Big(\tfrac{6-a}{6}\Big)^{\!n},\quad a=1,\dots,6.
          \]
        </p>

        <h2>2) Maximum of \(k\) such minimums</h2>
        <p>
          Let \(Z=\max(Y_1,\dots,Y_k)\) from \(k\) independent sets. The event \(Z\le a\) means
          every set‚Äôs minimum is \(\le a\). If \(F_Y(a)=\mathbb{P}(Y\le a)\), then
          \(\mathbb{P}(Z\le a)=[F_Y(a)]^k\). So:
        </p>
        <p>
          \[
            \mathbb{P}(Z=a)=[F_Y(a)]^k-[F_Y(a-1)]^k,\quad
            F_Y(a)=1-\Big(\tfrac{6-a}{6}\Big)^{n}.
          \]
        </p>

        <h2>3) Expected value (clean final)</h2>
        <p>
          Two equivalent ways:
        </p>
        <ul>
          <li>\(\displaystyle \mathbb{E}[Z]=\sum_{a=1}^{6} a\,\mathbb{P}(Z=a)\)</li>
          <li>\(\displaystyle \mathbb{E}[Z]=\sum_{a=1}^{6}\mathbb{P}(Z\ge a)\)
            with \(\mathbb{P}(Z\ge a)=1-[F_Y(a-1)]^k=1-\big(1-(\tfrac{7-a}{6})^{n}\big)^k\)</li>
        </ul>
        <p class="muted small">Now the formulas are just a compact way to write the ideas you already played with.</p>
      </div>
    </details>

    <footer class="muted small" style="margin-top:.75rem">
      Origin: a 24-hour train ride watching kids play dice. Great puzzles are just simple ideas with extra layers.
    </footer>
  </article>

  <script>
    // --- utilities ---
    function rollDie(){ return (Math.random()*6|0)+1; }

    function oneRun(nDice, nSets){
      const mins = [];
      const perSet = [];
      for(let s=0;s<nSets;s++){
        const rolls = Array.from({length:nDice}, rollDie);
        perSet.push(rolls);
        mins.push(Math.min(...rolls));
      }
      return { perSet, mins, maxOfMins: Math.max(...mins) };
    }

    function drawGrid(container, perSet, mins, maxOfMins){
      container.innerHTML = "";
      perSet.forEach((rolls, i) => {
        const row = document.createElement("div");
        row.className = "grid";
        if (mins[i] === maxOfMins) row.classList.add("best");
        rolls.forEach(v => {
          const cell = document.createElement("div");
          cell.className = "cell" + (v === mins[i] ? " min" : "");
          cell.textContent = v;
          row.appendChild(cell);
        });
        container.appendChild(row);
      });
    }

    // --- controls ---
    function $(id){ return document.getElementById(id); }
    function updateLabels(){
      $("nOut").textContent = $("nDice").value;
      $("kOut").textContent = $("nSets").value;
      $("tOut").textContent = $("nTrials").value;
    }
    updateLabels();

    // --- one interactive run ---
    function stepOnce(){
      const n = +$("nDice").value, k = +$("nSets").value;
      const {perSet, mins, maxOfMins} = oneRun(n,k);
      drawGrid($("onceArea"), perSet, mins, maxOfMins);
      $("onceText").innerHTML = `Minimums per set: <strong>${mins.join(", ")}</strong><br>Max of minimums: <strong>${maxOfMins}</strong> (outlined)`;
    }

    // --- many trials + histogram ---
    let histData = new Array(6).fill(0);

    function runTrials(){
      const n = +$("nDice").value, k = +$("nSets").value, T = +$("nTrials").value;
      histData.fill(0);
      for(let t=0;t<T;t++){
        const {maxOfMins} = oneRun(n,k);
        histData[maxOfMins-1]++;
      }
      drawHist(histData, T);
      const mean = histData.reduce((s,c,i)=>s + (i+1)*c, 0)/T;
      const probs = histData.map(c=> (c/T).toFixed(3));
      $("stats").innerHTML =
        `<p><strong>Average (empirical):</strong> ${mean.toFixed(3)}</p>`+
        `<p class="small muted">Distribution for 1..6: [ ${probs.join(" , ")} ]</p>`;
    }

    function clearSim(){
      histData.fill(0);
      const c = $("hist");
      const ctx = c.getContext("2d");
      ctx.clearRect(0,0,c.width,c.height);
      $("stats").innerHTML = "";
    }

    function drawHist(data, T){
      const c = $("hist");
      const ctx = c.getContext("2d");
      const W = c.width = c.clientWidth * devicePixelRatio;
      const H = c.height = 220 * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
      ctx.clearRect(0,0,W,H);

      // axes
      const left = 36, bottom = 24, top = 10, right = 10;
      const plotW = c.clientWidth - left - right, plotH = 220 - top - bottom;

      ctx.strokeStyle = getComputedStyle(document.body).color;
      ctx.globalAlpha = 0.3;
      ctx.beginPath();
      ctx.moveTo(left, top); ctx.lineTo(left, top+plotH); ctx.lineTo(left+plotW, top+plotH);
      ctx.stroke();
      ctx.globalAlpha = 1;

      // bars for 1..6
      const nBars = 6;
      const gap = 10, bw = (plotW - (nBars+1)*gap)/nBars;
      const maxP = Math.max(...data)/T || 1;

      for(let i=0;i<nBars;i++){
        const p = data[i]/T;
        const h = p/maxP * plotH;
        const x = left + gap + i*(bw+gap);
        const y = top + plotH - h;

        ctx.fillStyle = getComputedStyle(document.body).color;
        ctx.globalAlpha = 0.15;
        ctx.fillRect(x, y, bw, h);
        ctx.globalAlpha = 1;
        ctx.fillText(String(i+1), x+bw/2-3, top+plotH+14);
        ctx.fillText(p.toFixed(2), x+bw/2-10, y-4);
      }
      ctx.globalAlpha = 1;
    }

    // --- math typeset when opening the details ---
    const mathBox = $("mathBox");
    if (mathBox){
      mathBox.addEventListener("toggle", function(){
        if (mathBox.open && window.MathJax && MathJax.typesetPromise){
          MathJax.typesetPromise([mathBox]).catch((e)=>console.error("MathJax:", e));
        }
      });
    }

    // typeset on load in case of prerender
    (function(){
      const root = $("cq-article");
      if (window.MathJax && MathJax.typesetPromise && root){
        MathJax.typesetPromise([root]).catch(()=>{});
      }
    })();
  </script>
</body>
</html>


