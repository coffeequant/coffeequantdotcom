<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bet Sizing ‚Äî From Coin Flips to Kelly (and a Handy Approximation)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- MathJax loads globally in index.html -->

  <style>
    .cq-article{max-width:920px;margin:0 auto;padding:1rem 1.25rem 2rem;line-height:1.6;color:inherit}
    h1{font-size:1.9rem;margin:.2rem 0 .6rem;letter-spacing:-.01em}
    h2{font-size:1.25rem;margin:1.2rem 0 .5rem}
    .muted{opacity:.78}
    .pill{display:inline-block;border:1px solid color-mix(in oklab,currentColor 30%,transparent);
      border-radius:999px;padding:.15rem .6rem;font-size:.8rem;opacity:.9}
    .card{background:color-mix(in oklab,currentColor 8%,transparent);
      border:1px solid color-mix(in oklab,currentColor 24%,transparent);
      border-radius:12px;padding:1rem}
    .row{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center}
    .col{flex:1 1 260px}
    .btn{background:#2563eb;color:#fff;border:0;border-radius:8px;padding:.55rem .9rem;cursor:pointer;font-size:.95rem}
    .btn:hover{background:#1e40af}
    .btn-ghost{background:transparent;border:1px solid color-mix(in oklab,currentColor 30%,transparent);color:inherit}
    .slider{width:100%}
    canvas{width:100%;height:220px;border:1px solid color-mix(in oklab,currentColor 24%,transparent);border-radius:12px;background:transparent}
    .small{font-size:.92rem}
    .note{border-left:3px solid;color:inherit;border-color:color-mix(in oklab,currentColor 45%,transparent);
      background:color-mix(in oklab,currentColor 8%,transparent);padding:.6rem .8rem;border-radius:8px}
    details{border:1px dashed color-mix(in oklab,currentColor 30%,transparent);border-radius:10px;padding:.6rem .8rem}
    summary{cursor:pointer;font-weight:600}
    @media (prefers-color-scheme: dark){.btn{background:#38bdf8;color:#0b1220}.btn:hover{background:#0284c7}}
  </style>
</head>

<body>
  <article id="cq-article" class="cq-article">
    <header class="row" style="justify-content:space-between">
      <div>
        <h1>Bet Sizing ‚Äî From Coin Flips to Kelly (and a Handy Approximation)</h1>
        <div class="muted small">by <strong>Animesh Saxena</strong></div>
      </div>
      <span class="pill">Gambling ‚Ä¢ Probability ‚Ä¢ Strategy</span>
    </header>

    <p>
      Imagine you have $6 and access to a <em>slightly loaded</em> coin ‚Äî heads is more likely than tails. You get 5 flips.
      Each flip, you can risk a fraction of your wealth. Heads pays double the bet; tails loses it.
    </p>

    <p><strong>Question:</strong> What fraction should you bet each time to grow wealth fastest <em>without</em> blowing up?</p>

    <!-- PLAYGROUND -->
    <section class="card">
      <h2>Playground ‚Äî loaded coin</h2>
      <div class="row">
        <div class="col">
          <label>Initial wealth: $<span id="wealthOut">6</span></label>
          <input id="wealth" class="slider" type="range" min="1" max="20" step="1" value="6" oninput="ui()">
        </div>
        <div class="col">
          <label>Number of flips: <span id="flipsOut">5</span></label>
          <input id="flips" class="slider" type="range" min="1" max="20" step="1" value="5" oninput="ui()">
        </div>
        <div class="col">
          <label>Heads probability: <span id="probOut">0.60</span></label>
          <input id="prob" class="slider" type="range" min="0.50" max="0.90" step="0.01" value="0.60" oninput="ui()">
        </div>
      </div>
      <div class="row" style="margin-top:.6rem">
        <div class="col">
          <label>Bet fraction (of wealth): <span id="betOut">0.20</span></label>
          <input id="bet" class="slider" type="range" min="0.05" max="1.00" step="0.05" value="0.20" oninput="ui()">
        </div>
        <div class="col">
          <button class="btn" onclick="simulate()">üé≤ Run simulation</button>
          <button class="btn btn-ghost" onclick="clearChart()">Clear</button>
        </div>
      </div>

      <div style="margin-top:.6rem"><canvas id="chart"></canvas></div>
      <p id="result" class="small muted"></p>
    </section>

    <h2>Intuition first</h2>
    <p>You start with $6. Each flip, you risk some fraction \(\,f\,\) of your wealth.</p>
    <ul>
      <li>If the coin shows heads, you gain \(\,fW\,\) and end with \(W(1+f)\).</li>
      <li>If tails, you lose \(\,fW\,\) and end with \(W(1-f)\).</li>
    </ul>
    <p>
      Bet too little and you waste your edge. Bet too much and a short streak of tails wrecks you.  
      There is a sweet spot that <em>maximizes long-run growth</em>.
    </p>

    <div class="note">
      <strong>Common-sense rules</strong><br>
      1) Put the best payoffs on the most likely paths. 2) The average over all paths should match your starting wealth if you ‚Äúprice‚Äù paths fairly.  
      These ideas lead naturally to the Kelly answer below.
    </div>

    <!-- KELLY (DERIVATION) -->
    <details id="kellyBox" style="margin-top:1rem">
      <summary>Show the Kelly derivation (step by step)</summary>
      <div style="margin-top:.5rem">
        <h2>1 ‚Äî Define the wealth process correctly</h2>
        <p>
          Let \(W_i\) be your wealth before the \(i^{\text{th}}\) flip. You bet a fixed fraction \(f\) each time:
        </p>
        <p>
          \[
            W_{i+1} =
            \begin{cases}
              W_i(1 + f) & \text{with prob } p,\\[4pt]
              W_i(1 - f) & \text{with prob } 1-p.
            \end{cases}
          \]
        </p>

        <h2>2 ‚Äî Work in log space (because wealth compounds)</h2>
        <p>
          Expected log‚Äìgrowth per flip:
          \[
            g(f) = p\,\ln(1+f) + (1-p)\,\ln(1-f).
          \]
        </p>

        <h2>3 ‚Äî Maximize \(g(f)\)</h2>
        <p>
          Differentiate and set to zero:
          \[
            g'(f) = \frac{p}{1+f} - \frac{1-p}{1-f} = 0
            \;\;\Longrightarrow\;\;
            p(1-f) = (1-p)(1+f).
          \]
          Solve for \(f\):
          \[
            p - pf = 1 - p + f - pf
            \;\;\Longrightarrow\;\; f^* = 2p - 1.
          \]
        </p>

        <p><strong>Kelly fraction:</strong> with \(p=0.60\), \(f^* = 0.20\) ‚Üí bet 20% of wealth each flip.</p>

        <h2>4 ‚Äî Sanity checks</h2>
        <ul>
          <li>Fair coin \(p=0.5\) ‚Üí \(f^*=0\) (don‚Äôt bet).</li>
          <li>Small edge \(p=0.55\) ‚Üí \(f^*=0.10\) (bet small).</li>
          <li>Big edge \(p=0.9\) ‚Üí \(f^*=0.8\) (go big).</li>
        </ul>
      </div>
    </details>

    <!-- APPROXIMATION -->
    <details id="approxBox" style="margin-top:.75rem">
      <summary>A practical approximation (and when to use it)</summary>
      <div style="margin-top:.5rem">
        <p>
          In more complex setups (limited flips, caps, or path-based payouts), practitioners often use a
          quick sizing guide to avoid overbetting. One such heuristic is:
        </p>
        <p>
          \[
            f_{\text{approx}} \;\approx\; \frac{1.6\,W\,\big(1 - \frac{W}{M}\big)}{\sqrt{n}}
          \]
        </p>
        <ul>
          <li>\(W\): your current wealth (or stake) measured in the same ‚Äúunits‚Äù as the payoff cap.</li>
          <li>\(M\): maximum payout you‚Äôre targeting (a cap that keeps you from sizing too large).</li>
          <li>\(n\): number of independent ‚Äúshots‚Äù (flips/trades).</li>
        </ul>
        <p class="muted small">
          This isn‚Äôt a substitute for Kelly ‚Äî it‚Äôs a conservative shortcut when the clean Kelly inputs aren‚Äôt obvious,
          or when path caps / constraints mean ‚Äúfull Kelly‚Äù would be too punchy.
        </p>
      </div>
    </details>

    <footer class="muted small" style="margin-top:.9rem">
      If you can‚Äôt size a bet on a coin flip, you can‚Äôt size a trade in the market. Start simple; let the math guide the sizing.
    </footer>
  </article>

  <script>
    // ------- UI + Simulation -------
    const $ = id => document.getElementById(id);
    function ui(){
      $("wealthOut").textContent = $("wealth").value;
      $("flipsOut").textContent = $("flips").value;
      $("probOut").textContent  = (+$("prob").value).toFixed(2);
      $("betOut").textContent   = (+$("bet").value).toFixed(2);
    }
    ui();

    function simulate(){
      const W0 = +$("wealth").value;
      const n  = +$("flips").value;
      const p  = +$("prob").value;
      const f  = +$("bet").value;
      const wealth = [W0];
      let W = W0;

      for (let i=0;i<n;i++){
        const win = Math.random() < p;
        W *= (win ? (1+f) : (1-f));
        wealth.push(W);
      }

      drawChart(wealth);
      $("result").innerHTML = `Final wealth after ${n} flips: <strong>$${wealth[wealth.length-1].toFixed(2)}</strong>`;
    }

    function clearChart(){
      const c=$("chart"),ctx=c.getContext("2d");
      ctx.clearRect(0,0,c.width,c.height);
      $("result").textContent="";
    }

    function drawChart(data){
      const c=$("chart"),ctx=c.getContext("2d");
      const W=c.width=c.clientWidth*devicePixelRatio,H=c.height=220*devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
      ctx.clearRect(0,0,c.width,c.height);

      const left=36,right=10,top=10,bottom=24;
      const w=c.clientWidth-left-right,h=220-top-bottom;

      const minY=Math.min(...data)*0.9, maxY=Math.max(...data)*1.1;
      const y=v=>top+h*(1-(v-minY)/(maxY-minY));
      const x=i=>left+i*(w/(data.length-1));

      ctx.strokeStyle=getComputedStyle(document.body).color;
      ctx.globalAlpha=.3;
      ctx.beginPath();ctx.moveTo(left,top);ctx.lineTo(left,top+h);ctx.lineTo(left+w,top+h);ctx.stroke();
      ctx.globalAlpha=1;

      ctx.beginPath();ctx.moveTo(x(0),y(data[0]));
      for(let i=1;i<data.length;i++) ctx.lineTo(x(i),y(data[i]));
      ctx.stroke();

      ctx.fillText("flips ‚Üí", left+w-40, top+h+16);
      ctx.fillText("wealth", left-30, top+10);
    }

    // ------- MathJax re-typeset on open + after load -------
    function typesetHere(node){
      if (window.MathJax && MathJax.typesetPromise && node){
        MathJax.typesetPromise([node]).catch(()=>{});
      }
    }
    const kellyBox = document.getElementById("kellyBox");
    const approxBox = document.getElementById("approxBox");
    if (kellyBox) kellyBox.addEventListener("toggle", ()=>{ if (kellyBox.open) typesetHere(kellyBox); });
    if (approxBox) approxBox.addEventListener("toggle", ()=>{ if (approxBox.open) typesetHere(approxBox); });

    // Also typeset the whole article once after injection (Dojo safe)
    (function(){
      const root=document.getElementById('cq-article');
      if (document.readyState === 'complete' || document.readyState === 'interactive') typesetHere(root);
      else document.addEventListener('DOMContentLoaded', ()=>typesetHere(root));
    })();
  </script>

<script>
  (function () {
    var root = document.getElementById('cq-article');
    function typeset() {
      if (window.MathJax && MathJax.typesetPromise && root) {
        MathJax.typesetPromise([root]).catch(console.error);
      }
    }
    if (document.readyState === 'complete' || document.readyState === 'interactive') typeset();
    else document.addEventListener('DOMContentLoaded', typeset);
  })();
</script>


</body>
</html>

