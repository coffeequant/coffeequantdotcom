<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CoffeeQuant ‚Äî Daily sparks, playground labs, and desk truth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- MathJax (global, once) -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['\\[', '\\]'], ['$$','$$']],
        processEscapes: true,
        tags: 'ams'
      },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <!-- Theme / layout -->
  <link rel="stylesheet" href="statics/css/cq.css" />

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Expose your Google client id for auth.js -->
  <script>
    // TODO: put your real Web client ID here (the one that allows localhost & coffee.coffeequant.com)
    window.CQ_GOOGLE_CLIENT_ID = "58596950813-89s7vbdb1lnhom1t93mc979lgp5143eo.apps.googleusercontent.com";
  </script>

  <!-- Auth logic (Google login + premium gating) -->
  <script src="statics/js/auth.js" defer></script>
</head>

<body>

  <!-- ====== NAV WRAPPER ====== -->
  <div class="cq-shell">
    <nav class="cq-nav" role="navigation" aria-label="Main">
      <a class="cq-logo" href="/" aria-label="CoffeeQuant Home">‚òï CoffeeQuant</a>

      <div class="cq-navlinks">
        <a href="#daily">Daily</a>
        <a href="#labs">Labs</a>
        <a href="#tools">Tools</a>
        <a href="#notes">Notes</a>
        <a href="#curios">Curios</a>
	<a href="statics/WriteUps/Premium.html">Premium</a>
        <a href="statics/WriteUps/" class="cq-hide">Archive</a>
      </div>

      <!-- Auth area (single instance) -->
      <div id="cqAuthBox" class="cq-authbox">
        <div id="cqAuthLabel" class="cq-auth-label cq-muted">Not signed in</div>
        <button id="cqSignInBtn" class="cq-btn-ghost-small">Sign in</button>
        <button id="cqSignOutBtn" class="cq-btn-ghost-small" style="display:none;">Sign out</button>
        <!-- Google-rendered button lives here (we keep it small / subtle) -->
        <div id="gSignInBtn" class="cq-google-btn-container"></div>
      </div>
    </nav>

    <!-- ====== HERO SECTION ====== -->
    <section class="cq-hero" aria-labelledby="heroTitle">
      <!-- background image gets injected from hero.json -->
      <div class="cq-hero__bg" id="heroBg"></div>
      <div class="cq-hero__overlay"></div>

      <!-- subtle animated steam -->
      <div class="cq-steam" aria-hidden="true">
        <svg viewBox="0 0 1200 400" preserveAspectRatio="none">
          <path d="M200,340 C260,280 280,240 300,200" />
          <path d="M420,340 C460,300 500,250 520,210" />
          <path d="M740,340 C780,300 820,250 840,210" />
        </svg>
      </div>

      <div class="cq-hero__content">
        <h1 id="heroTitle">Daily sparks. Playable math. Real desk intuition.</h1>
        <p class="cq-muted cq-hero-tagline">
          Fast, no-bull takes on risk, optionality, and weird market edges ‚Äî
          built for desks, structurers, and people who actually trade risk.
        </p>
        <div class="cq-cta">
          <a class="cq-btn" href="#labs">Explore Labs</a>
          <a class="cq-btn-ghost" href="#daily">Today‚Äôs Spark</a>
        </div>
      </div>
    </section>
  </div>

  <!-- ====== MAIN GRID LAYOUT ====== -->
  <main class="cq-main cq-maingrid" role="main">

    <!-- LEFT DOCK / NAV PANEL -->
    <aside class="cq-dock" aria-label="Section navigation">
      <h4>Navigate</h4>
      <a href="#daily">üì∞ Daily</a>
      <a href="#labs">üß™ Labs</a>
      <a href="#tools">‚å®Ô∏è Tools</a>
      <a href="#notes">üìù Notes</a>
      <a href="#curios">üîó Curios</a>

      <h4 style="margin-top:1rem">Shortcuts</h4>
      <a href="#" id="openKbar">‚åòK ¬∑ Command palette</a>
      <a href="statics/Tools/PricingCLI.html">‚ñ∂ Pricing CLI</a>
    </aside>

    <!-- RIGHT CONTENT COLUMN -->
    <div class="cq-content-col">

      <!-- ====== DAILY ====== -->
      <section id="daily" class="cq-section" aria-labelledby="sec-daily">
        <div class="cq-strip" data-strip="daily"></div>
        <div class="cq-section-head">
          <h2 id="sec-daily">CoffeeQuant Daily</h2>
          <span class="cq-pill">60-second spark</span>
        </div>

        <!-- one featured card from daily.json -->
        <article id="dailyCard" class="cq-card cq-card-block cq-daily" aria-live="polite">
          <div class="cq-skeleton">Loading today‚Äôs spark‚Ä¶</div>
        </article>
      </section>

      <!-- ====== LABS ====== -->
      <section id="labs" class="cq-section" aria-labelledby="sec-labs">
        <div class="cq-strip" data-strip="labs"></div>
        <div class="cq-section-head">
          <h2 id="sec-labs">Playground Labs</h2>
          <span class="cq-pill">Interactive</span>
        </div>

        <!-- cards injected from labs.json -->
        <div id="labsList" class="cq-grid cq-card-block">
          <div class="cq-skeleton">Loading labs‚Ä¶</div>
        </div>
      </section>

      <!-- ====== TOOLS ====== -->
      <section id="tools" class="cq-section" aria-labelledby="sec-tools">
        <div class="cq-strip" data-strip="tools"></div>
        <div class="cq-section-head">
          <h2 id="sec-tools">Tools</h2>
          <span class="cq-pill">Try in browser</span>
        </div>

        <!-- cards injected from tools.json -->
        <div id="toolsList" class="cq-grid cq-card-block">
          <div class="cq-skeleton">Loading tools‚Ä¶</div>
        </div>
      </section>

      <!-- ====== NOTES ====== -->
      <section id="notes" class="cq-section" aria-labelledby="sec-notes">
        <div class="cq-strip" data-strip="notes"></div>
        <div class="cq-section-head">
          <h2 id="sec-notes">Notes from the Desk</h2>
          <span class="cq-pill">Readable depth</span>
        </div>

        <!-- cards injected from notes.json -->
        <div id="notesList" class="cq-grid cq-card-block cq-notes-tight">
          <div class="cq-skeleton">Loading notes‚Ä¶</div>
        </div>
      </section>

      <!-- ====== CURIOS ====== -->
      <section id="curios" class="cq-section" aria-labelledby="sec-curios">
        <div class="cq-strip" data-strip="curios"></div>
        <div class="cq-section-head">
          <h2 id="sec-curios">Quant Curiosities</h2>
          <span class="cq-pill">Links & ideas</span>
        </div>

        <!-- compact list from curios.json -->
        <div id="curiosList" class="cq-list cq-list--compact cq-card-block">
          <div class="cq-skeleton">Loading curiosities‚Ä¶</div>
        </div>
      </section>

    </div>
  </main>

  <!-- ====== FOOTER ====== -->
  <footer class="cq-footer">
    <div class="cq-shell">
      <div>‚òï CoffeeQuant ¬∑ Fast. Minimal. Curious. No ads.</div>
      <div style="margin-top:.4rem">
        <a href="rss.xml">RSS</a> ¬∑
        <a href="mailto:hello@coffeequant.example">Contact</a>
      </div>
    </div>
  </footer>

  <!-- ====== COMMAND PALETTE OVERLAY (‚åòK / Ctrl+K) ====== -->
  <div id="cqKbar" class="cq-kbar" aria-hidden="true">
    <div class="cq-kbar-box" role="dialog" aria-label="Command palette">
      <input id="kbarInput" placeholder="Type a command‚Ä¶ (e.g., 'dice', 'kelly', 'pricing')" />
      <div id="kbarList" class="cq-kbar-list"></div>
    </div>
  </div>

  <!-- ====== SUPPORT SCRIPTS ====== -->
  <!-- Cover generator for tiles missing 'thumb' -->
  <script src="statics/js/cq-covers.js"></script>

  <!-- PAGE BOOTSTRAP / RENDER LOGIC -->
  <script>
  // ---------- helpers ----------
  const $ = (sel, root=document) => root.querySelector(sel);

  async function loadJSON(path){
    try {
      const r = await fetch(path, {cache:'no-store'});
      if(!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    } catch(e){ return null; }
  }

  function fmtDate(iso){
    try {
      return new Date(iso).toLocaleDateString(undefined,{
        year:'numeric',month:'short',day:'numeric'
      });
    } catch(e){ return ''; }
  }

  // ---------- HERO BACKGROUND ----------
  async function renderHeroBg(){
    const slot = $('#heroBg'); if(!slot) return;
    const data = await loadJSON('statics/data/hero.json');
    if(!data || !data.images || !data.images.length) return;
    const idx = (new Date()).getDay() % data.images.length;
    const it = data.images[idx];
    if(it && it.src){
      slot.style.backgroundImage = `url("${it.src}")`;
      slot.setAttribute('aria-label', it.alt || 'hero background');
    }
  }

  // ---------- DAILY ----------
  async function renderDaily(){
    const data = await loadJSON('statics/data/daily.json');
    const host = $('#dailyCard');
    if(!host) return;

    if(!data || !data.items || !data.items.length){
      host.innerHTML = '<div class="cq-skeleton">No daily item yet.</div>';
      return;
    }

    const today = new Date().toISOString().slice(0,10);
    const exactIdx = data.items.findIndex(i => i.date === today);
    const pick = exactIdx >= 0 ? exactIdx : (new Date().getDay() % data.items.length);
    const it = data.items[pick];

    host.innerHTML = `
      <div class="cq-card-thumb">
        ${ it.thumb ? `<img src="${it.thumb}" alt="">` : '' }
      </div>
      <div class="cq-card-body">
        <h3 class="cq-card-title">
          ${ it.link ? `<a href="${it.link}">${it.title}</a>` : it.title }
        </h3>
        <p class="cq-card-deck cq-muted">${it.deck || ''}</p>
        ${it.html ? `<div>${it.html}</div>` : ''}
        <div class="cq-card-meta cq-muted">${fmtDate(it.date) || ''}</div>
      </div>
    `;

    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise([host]).catch(console.error);
    }
  }

  // ---------- generic grid renderer (labs / tools / notes) ----------
  function renderGrid(listEl, items){
    listEl.innerHTML = items.map(it => `
      <a class="cq-tile ${it.premium ? 'cq-tile--premium' : ''}" href="${it.link}">
        ${ it.premium ? '<div class="cq-tile-badge cq-pill cq-pill-premium">Premium</div>' : '' }
        <div class="cq-imgwrap">
          ${ it.thumb
             ? `<img src="${it.thumb}" alt="" class="cq-imgthumb" />`
             : `<div class="cq-imggen" data-cover="${it.title}"></div>`
          }
        </div>
        <h3>${it.title}</h3>
        <p class="cq-muted">${it.deck || ''}</p>
        <div class="cq-tags">
          ${(it.tags||[]).map(t=>`<span>${t}</span>`).join('')}
        </div>
      </a>
    `).join('');
  }

  async function renderLabs(){
    const data = await loadJSON('statics/data/labs.json');
    const host = $('#labsList'); if(!host) return;
    if(!data || !data.items || !data.items.length){
      host.innerHTML = '<div class="cq-skeleton">No labs yet.</div>';
      return;
    }
    renderGrid(host, data.items);
  }

  async function renderTools(){
    const data = await loadJSON('statics/data/tools.json');
    const host = $('#toolsList'); if(!host) return;
    if(!data || !data.items || !data.items.length){
      host.innerHTML = '<div class="cq-skeleton">No tools yet.</div>';
      return;
    }
    renderGrid(host, data.items);
  }

  async function renderNotes(){
    const data = await loadJSON('statics/data/notes.json');
    const host = $('#notesList'); if(!host) return;
    if(!data || !data.items || !data.items.length){
      host.innerHTML = '<div class="cq-skeleton">No notes yet.</div>';
      return;
    }
    renderGrid(host, data.items.slice(0,6));
  }

  async function renderCurios(){
    const data = await loadJSON('statics/data/curios.json');
    const host = $('#curiosList'); if(!host) return;
    if(!data || !data.items || !data.items.length){
      host.innerHTML = '<div class="cq-skeleton">No curios yet.</div>';
      return;
    }
    host.innerHTML = data.items.map(it => `
      <div class="cq-list-item ${it.premium ? 'cq-list-item--premium' : ''}">
        <div class="cq-list-main">
          <div class="cq-list-title">
            ${it.link ? `<a href="${it.link}">${it.title}</a>` : it.title}
            ${ it.premium ? '<span class="cq-pill cq-pill-premium cq-pill-premium-inline">Premium</span>' : '' }
          </div>
          <div class="cq-list-desc cq-muted">${it.deck || ''}</div>
        </div>
        <div class="cq-list-meta cq-muted">${fmtDate(it.date) || ''}</div>
      </div>
    `).join('');
  }

  // ---------- INIT ----------
  (async function initPage(){
    await renderHeroBg();
    await renderDaily();
    await renderLabs();
    await renderTools();
    await renderNotes();
    await renderCurios();

    // generate fallback covers
    document.querySelectorAll('.cq-imggen[data-cover]').forEach(div=>{
      if (window.CQCover) {
        CQCover.inject(div, div.getAttribute('data-cover'));
      } else {
        const txt = div.getAttribute('data-cover') || '';
        const parts = txt.trim().split(/\s+/);
        const initials = (parts[0]?.[0]||'').toUpperCase() + (parts[1]?.[0]||'');
        div.textContent = initials || 'CQ';
      }
    });

    if (window.MathJax && MathJax.typesetPromise){
      MathJax.typesetPromise().catch(()=>{});
    }
  })();
  </script>

</body>
</html>
